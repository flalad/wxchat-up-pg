# 管理后台设置指南

## 🎯 概述

本指南将帮助你为微信文件传输助手项目设置完整的管理后台系统。管理后台包含以下功能：

- 📊 **仪表板**：系统概览和统计信息
- 💬 **信息管理**：查看和管理用户消息
- 📁 **文件管理**：查看和管理上传的文件
- 👥 **用户管理**：管理用户账户和权限

## 🚀 快速设置

### 1. 初始化数据库

```bash
# 初始化基础数据库结构
npm run db:init

# 初始化管理后台数据库结构
npm run db:init-admin

# 或者一次性初始化所有数据库
npm run db:init-all
```

### 2. 部署项目

```bash
# 构建 Pages 项目
npm run build:pages

# 部署到 Cloudflare Pages
npm run pages:deploy
```

### 3. 配置环境绑定

在 Cloudflare Dashboard 中配置以下绑定：

#### D1 数据库绑定
- **Variable name**: `DB`
- **D1 database**: `wxchat`

#### R2 存储桶绑定
- **Variable name**: `R2`
- **R2 bucket**: `wxchat`

## 🔐 管理员账户

### 默认管理员账户

系统会自动创建一个默认管理员账户：

- **用户名**: `admin`
- **密码**: `admin123`
- **角色**: 管理员

> ⚠️ **重要安全提示**: 首次登录后请立即修改默认密码！

### 创建新管理员

1. 使用默认账户登录管理后台
2. 进入"用户管理"页面
3. 找到要提升为管理员的用户
4. 点击"设为管理员"按钮

## 📱 访问管理后台

### 方式一：通过主页面

1. 访问主页面
2. 点击右上角的"管理员"按钮
3. 输入管理员账户信息登录

### 方式二：直接访问

直接访问 `https://your-domain.com/admin.html`

## 🎨 功能详解

### 📊 仪表板

仪表板提供系统的整体概览：

- **统计卡片**: 显示用户数、消息数、文件数、存储使用量
- **活动图表**: 最近7天的消息和文件活动趋势
- **文件类型分布**: 不同类型文件的分布情况
- **最近用户**: 最新注册的用户列表

### 💬 信息管理

信息管理页面允许你：

- 查看所有用户的消息记录
- 按类型筛选（文本/文件消息）
- 搜索特定内容
- 删除不当消息
- 分页浏览历史记录

### 📁 文件管理

文件管理页面功能：

- 查看所有上传的文件
- 按文件类型筛选
- 搜索文件名
- 批量选择和删除
- 下载文件
- 查看文件统计信息

### 👥 用户管理

用户管理页面可以：

- 查看所有注册用户
- 启用/禁用用户账户
- 设置用户角色（管理员/普通用户）
- 删除用户账户
- 查看用户活动统计

## 🔧 高级配置

### 自定义管理员密码

如果需要修改默认管理员密码，可以：

1. 登录管理后台
2. 在用户管理中找到admin用户
3. 或者直接在数据库中更新密码哈希

### 批量操作

管理后台支持以下批量操作：

- 批量删除文件
- 批量管理用户状态
- 数据导出功能

### 数据导出

可以导出以下数据：

```javascript
// 在浏览器控制台中执行
exportMessages()  // 导出消息数据
exportFiles()     // 导出文件数据
exportUsers()     // 导出用户数据
```

## 🛡️ 安全建议

### 1. 密码安全

- 使用强密码
- 定期更换密码
- 不要共享管理员账户

### 2. 访问控制

- 限制管理员数量
- 定期审查用户权限
- 监控异常登录活动

### 3. 数据备份

- 定期备份D1数据库
- 备份重要文件
- 制定数据恢复计划

## 📊 监控和维护

### 系统监控

管理后台提供以下监控功能：

- 实时用户活动
- 存储使用情况
- 系统性能指标
- 错误日志记录

### 定期维护

建议定期执行以下维护任务：

1. **清理过期数据**
   - 删除长期未使用的文件
   - 清理无效用户账户

2. **性能优化**
   - 监控数据库大小
   - 优化查询性能

3. **安全检查**
   - 审查用户权限
   - 检查异常活动

## 🚨 故障排除

### 常见问题

#### 1. 无法登录管理后台

**可能原因**:
- 数据库未正确初始化
- 环境绑定配置错误
- 密码错误

**解决方案**:
```bash
# 重新初始化数据库
npm run db:init-all

# 检查 Cloudflare Dashboard 中的绑定配置
```

#### 2. 数据加载失败

**可能原因**:
- API 权限问题
- 数据库连接失败
- 网络问题

**解决方案**:
- 检查浏览器控制台错误
- 验证API接口响应
- 确认数据库绑定正确

#### 3. 文件操作失败

**可能原因**:
- R2 存储桶权限问题
- 文件大小限制
- 网络超时

**解决方案**:
- 检查R2绑定配置
- 确认文件大小在限制范围内
- 重试操作

### 调试工具

管理后台提供以下调试工具：

```javascript
// 在浏览器控制台中使用
showSystemInfo()  // 显示系统信息
clearCache()      // 清理缓存
AdminApp.getAppStats()  // 获取应用统计
```

## 📞 技术支持

如果遇到问题，可以：

1. 查看浏览器控制台错误信息
2. 检查 Cloudflare Dashboard 中的日志
3. 参考项目文档
4. 提交 GitHub Issue

## 🔄 更新和升级

### 版本更新

当有新版本发布时：

1. 备份当前数据
2. 更新代码
3. 运行数据库迁移（如需要）
4. 重新部署

### 功能扩展

管理后台采用模块化设计，可以轻松扩展新功能：

- 添加新的统计图表
- 扩展用户权限系统
- 集成第三方服务
- 自定义主题样式

---

🎉 **恭喜！** 你已经成功设置了完整的管理后台系统。现在可以高效地管理你的微信文件传输助手项目了！