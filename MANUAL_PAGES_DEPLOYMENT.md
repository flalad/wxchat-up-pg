# Cloudflare Pages æ‰‹åŠ¨éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ‰‹åŠ¨éƒ¨ç½²æµç¨‹æ¦‚è¿°

æ‰‹åŠ¨éƒ¨ç½²åˆ° Cloudflare Pages ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š
1. **é€šè¿‡ Cloudflare Dashboard ç½‘é¡µç•Œé¢éƒ¨ç½²**
2. **é€šè¿‡ Wrangler CLI æ‰‹åŠ¨éƒ¨ç½²**

## ğŸŒ æ–¹å¼ä¸€ï¼šé€šè¿‡ Cloudflare Dashboard éƒ¨ç½²

### æ­¥éª¤ 1ï¼šå‡†å¤‡é¡¹ç›®æ–‡ä»¶

```bash
# 1. æ„å»º Pages é¡¹ç›®
npm run build:pages

# 2. ç¡®è®¤ public ç›®å½•ç»“æ„
# public/
# â”œâ”€â”€ index.html
# â”œâ”€â”€ css/
# â”œâ”€â”€ js/
# â”œâ”€â”€ _functions/
# â””â”€â”€ _routes.json
```

### æ­¥éª¤ 2ï¼šç™»å½• Cloudflare Dashboard

1. è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com)
2. ç™»å½•ä½ çš„ Cloudflare è´¦æˆ·
3. åœ¨å·¦ä¾§èœå•ä¸­é€‰æ‹© **"Pages"**

### æ­¥éª¤ 3ï¼šåˆ›å»º Pages é¡¹ç›®

#### é€‰é¡¹ Aï¼šè¿æ¥ Git ä»“åº“ï¼ˆæ¨èï¼‰

1. ç‚¹å‡» **"Create a project"**
2. é€‰æ‹© **"Connect to Git"**
3. é€‰æ‹©ä½ çš„ Git æä¾›å•†ï¼ˆGitHubã€GitLab ç­‰ï¼‰
4. æˆæƒ Cloudflare è®¿é—®ä½ çš„ä»“åº“
5. é€‰æ‹© `wxchat` ä»“åº“

#### é€‰é¡¹ Bï¼šç›´æ¥ä¸Šä¼ æ–‡ä»¶

1. ç‚¹å‡» **"Create a project"**
2. é€‰æ‹© **"Upload assets"**
3. å°†æ•´ä¸ª `public` ç›®å½•æ‹–æ‹½åˆ°ä¸Šä¼ åŒºåŸŸ
4. æˆ–è€…é€‰æ‹© `public` ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ 

### æ­¥éª¤ 4ï¼šé…ç½®æ„å»ºè®¾ç½®

å¦‚æœé€‰æ‹©äº† Git è¿æ¥ï¼Œéœ€è¦é…ç½®æ„å»ºè®¾ç½®ï¼š

```
é¡¹ç›®åç§°: wxchat-pages
ç”Ÿäº§åˆ†æ”¯: main
æ¡†æ¶é¢„è®¾: None
æ„å»ºå‘½ä»¤: npm run build:pages
æ„å»ºè¾“å‡ºç›®å½•: public
æ ¹ç›®å½•: /
```

### æ­¥éª¤ 5ï¼šé…ç½®ç¯å¢ƒç»‘å®š

åœ¨é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œè¿›å…¥é¡¹ç›®è®¾ç½®ï¼š

1. ç‚¹å‡»é¡¹ç›®åç§°è¿›å…¥é¡¹ç›®è¯¦æƒ…
2. é€‰æ‹© **"Settings"** æ ‡ç­¾
3. é€‰æ‹© **"Functions"** å­æ ‡ç­¾

#### é…ç½® D1 æ•°æ®åº“ç»‘å®š

1. åœ¨ **"D1 database bindings"** éƒ¨åˆ†ç‚¹å‡» **"Add binding"**
2. å¡«å†™é…ç½®ï¼š
   ```
   Variable name: DB
   D1 database: wxchat
   ```

#### é…ç½® R2 å­˜å‚¨æ¡¶ç»‘å®š

1. åœ¨ **"R2 bucket bindings"** éƒ¨åˆ†ç‚¹å‡» **"Add binding"**
2. å¡«å†™é…ç½®ï¼š
   ```
   Variable name: R2
   R2 bucket: wxchat
   ```

### æ­¥éª¤ 6ï¼šéƒ¨ç½²é¡¹ç›®

1. å¦‚æœæ˜¯ Git è¿æ¥ï¼šæ¨é€ä»£ç åˆ°ä»“åº“ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
2. å¦‚æœæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼šä¸Šä¼ å®Œæˆåä¼šè‡ªåŠ¨å¼€å§‹éƒ¨ç½²

### æ­¥éª¤ 7ï¼šéªŒè¯éƒ¨ç½²

1. éƒ¨ç½²å®Œæˆåï¼ŒCloudflare ä¼šæä¾›ä¸€ä¸ª `.pages.dev` åŸŸå
2. è®¿é—®è¯¥åŸŸåéªŒè¯åº”ç”¨æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. æµ‹è¯• API åŠŸèƒ½ï¼š
   - å‘é€æ–‡æœ¬æ¶ˆæ¯
   - ä¸Šä¼ æ–‡ä»¶
   - ä¸‹è½½æ–‡ä»¶

## âš¡ æ–¹å¼äºŒï¼šé€šè¿‡ Wrangler CLI æ‰‹åŠ¨éƒ¨ç½²

### æ­¥éª¤ 1ï¼šå®‰è£…å’Œç™»å½•

```bash
# ç¡®ä¿å·²å®‰è£… wrangler
npm install -g wrangler

# ç™»å½• Cloudflare
wrangler login
```

### æ­¥éª¤ 2ï¼šæ„å»ºé¡¹ç›®

```bash
# æ„å»º Pages é¡¹ç›®
npm run build:pages
```

### æ­¥éª¤ 3ï¼šåˆ›å»º Pages é¡¹ç›®

```bash
# åˆ›å»º Pages é¡¹ç›®
wrangler pages project create wxchat-pages
```

### æ­¥éª¤ 4ï¼šé…ç½®ç»‘å®š

```bash
# é…ç½® D1 æ•°æ®åº“ç»‘å®š
wrangler pages secret put DB --project-name=wxchat-pages

# é…ç½® R2 å­˜å‚¨æ¡¶ç»‘å®š
wrangler pages secret put R2 --project-name=wxchat-pages
```

### æ­¥éª¤ 5ï¼šéƒ¨ç½²é¡¹ç›®

```bash
# éƒ¨ç½²åˆ° Pages
wrangler pages deploy ./public --project-name=wxchat-pages --compatibility-date=2025-06-17
```

### æ­¥éª¤ 6ï¼šé…ç½®ç»‘å®šï¼ˆé€šè¿‡ Dashboardï¼‰

ç”±äº CLI é…ç½®ç»‘å®šè¾ƒå¤æ‚ï¼Œå»ºè®®é€šè¿‡ Dashboard é…ç½®ï¼š

1. è®¿é—® [Cloudflare Dashboard](https://dash.cloudflare.com)
2. è¿›å…¥ Pages â†’ wxchat-pages â†’ Settings â†’ Functions
3. æŒ‰ç…§æ–¹å¼ä¸€çš„æ­¥éª¤ 5 é…ç½® D1 å’Œ R2 ç»‘å®š

## ğŸ”§ é…ç½®è‡ªå®šä¹‰åŸŸåï¼ˆå¯é€‰ï¼‰

### æ­¥éª¤ 1ï¼šæ·»åŠ åŸŸå

1. åœ¨é¡¹ç›®è®¾ç½®ä¸­é€‰æ‹© **"Custom domains"**
2. ç‚¹å‡» **"Set up a custom domain"**
3. è¾“å…¥ä½ çš„åŸŸåï¼ˆå¦‚ï¼š`wxchat.yourdomain.com`ï¼‰

### æ­¥éª¤ 2ï¼šé…ç½® DNS

1. åœ¨ä½ çš„åŸŸåæä¾›å•†å¤„æ·»åŠ  CNAME è®°å½•ï¼š
   ```
   åç§°: wxchat
   ç±»å‹: CNAME
   å€¼: wxchat-pages.pages.dev
   ```

### æ­¥éª¤ 3ï¼šéªŒè¯åŸŸå

1. ç­‰å¾… DNS ä¼ æ’­ï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰
2. Cloudflare ä¼šè‡ªåŠ¨éªŒè¯åŸŸåå¹¶é¢å‘ SSL è¯ä¹¦

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥

- [ ] å·²è¿è¡Œ `npm run build:pages`
- [ ] `public` ç›®å½•åŒ…å«æ‰€æœ‰å¿…è¦æ–‡ä»¶
- [ ] `public/_functions` ç›®å½•å­˜åœ¨ä¸”åŒ…å« API æ–‡ä»¶
- [ ] `public/_routes.json` æ–‡ä»¶å­˜åœ¨
- [ ] D1 æ•°æ®åº“å·²åˆ›å»ºå¹¶åˆå§‹åŒ–
- [ ] R2 å­˜å‚¨æ¡¶å·²åˆ›å»º

### éƒ¨ç½²åæ£€æŸ¥

- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] é™æ€æ–‡ä»¶ï¼ˆCSSã€JSï¼‰åŠ è½½æ­£å¸¸
- [ ] API æ¥å£å“åº”æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶ä¸‹è½½åŠŸèƒ½æ­£å¸¸
- [ ] è·¨è®¾å¤‡åŒæ­¥åŠŸèƒ½æ­£å¸¸

## ğŸš¨ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šFunctions ä¸å·¥ä½œ

**ç—‡çŠ¶**ï¼šAPI è¯·æ±‚è¿”å› 404 é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `_routes.json` é…ç½®æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ `_functions` ç›®å½•ç»“æ„æ­£ç¡®
3. éªŒè¯ D1 å’Œ R2 ç»‘å®šé…ç½®

### é—®é¢˜ 2ï¼šé™æ€æ–‡ä»¶ 404

**ç—‡çŠ¶**ï¼šCSSã€JS æ–‡ä»¶æ— æ³•åŠ è½½

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `_routes.json` ä¸­çš„ exclude è§„åˆ™
2. ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®
3. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨äº `public` ç›®å½•

### é—®é¢˜ 3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šAPI è¿”å›æ•°æ®åº“é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ D1 æ•°æ®åº“ç»‘å®šé…ç½®æ­£ç¡®
2. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å·²åˆå§‹åŒ–
3. éªŒè¯æ•°æ®åº“ ID æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 4ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**ï¼šæ–‡ä»¶ä¸Šä¼ è¿”å›é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ R2 å­˜å‚¨æ¡¶ç»‘å®šé…ç½®æ­£ç¡®
2. æ£€æŸ¥å­˜å‚¨æ¡¶æƒé™è®¾ç½®
3. éªŒè¯æ–‡ä»¶å¤§å°é™åˆ¶

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°éƒ¨ç½²é—®é¢˜ï¼š

1. æŸ¥çœ‹ Cloudflare Pages éƒ¨ç½²æ—¥å¿—
2. æ£€æŸ¥æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ç½‘ç»œå’Œæ§åˆ¶å°
3. å‚è€ƒ [Cloudflare Pages å®˜æ–¹æ–‡æ¡£](https://developers.cloudflare.com/pages/)
4. æäº¤ [Issue](https://github.com/flalad/wxchat/issues) è·å–æ”¯æŒ

## ğŸ¯ æ¨èéƒ¨ç½²æ–¹å¼

å¯¹äºä¸åŒåœºæ™¯çš„æ¨èï¼š

- **å¼€å‘æµ‹è¯•**ï¼šä½¿ç”¨ CLI éƒ¨ç½²ï¼Œå¿«é€Ÿè¿­ä»£
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šä½¿ç”¨ Git è¿æ¥ï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½²
- **ä¸€æ¬¡æ€§éƒ¨ç½²**ï¼šä½¿ç”¨æ–‡ä»¶ä¸Šä¼ ï¼Œç®€å•ç›´æ¥

é€‰æ‹©æœ€é€‚åˆä½ éœ€æ±‚çš„éƒ¨ç½²æ–¹å¼å³å¯ï¼